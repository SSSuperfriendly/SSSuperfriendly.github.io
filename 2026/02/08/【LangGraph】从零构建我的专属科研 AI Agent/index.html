<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Kunpeng Chen</title><meta name="author" content="Chen Kunpeng"><link rel="shortcut icon" href="/img/favicon.png?v=20260117"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\[',right:'\\]',display:true},{left:'\\(',right:'\\)',display:false}],throwOnError:false,strict:false})"></script><meta name="generator" content="Hexo 8.1.1"></head><body><header id="page_header"><div class="header_wrap"><div id="blog_name"><a class="blog_title" id="site-name" href="/">Kunpeng Chen</a></div><button class="menus_icon"><div class="navicon"></div></button><ul class="menus_items"><li class="menus_item"><a class="site-page" href="/"> About Me</a></li><li class="menus_item"><a class="site-page" href="/news/"> News</a></li><li class="menus_item"><a class="site-page" href="/#Publications"> Publications</a></li><li class="menus_item"><a class="site-page" href="/categories/Blogs/"> Blogs</a></li></ul></div></header><main id="page_main"><div class="side-card sticky"><div class="card-wrap" itemscope itemtype="http://schema.org/Person"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/profile.png'" alt="avatar"></div><div class="author-discrip"><h3>Chen Kunpeng</h3><p class="author-bio"><strong>Tongji University</strong>. Focusing on Trustworthy AI & Federated Learning.</p></div><div class="author-links"><button class="btn m-social-links">Links</button><ul class="social-icons"><li><a class="social-icon" href="https://x.com/4tHobieb8n15222/" target="_blank"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-facebook-square" aria-hidden="true"></i></a></li><li><a class="social-icon" href="https://github.com/SSSuperfriendly" target="_blank"><i class="fab fa-github" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-weibo" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-weixin" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-qq" aria-hidden="true"></i></a></li><li><a class="social-icon" href="mailto:chenkunpeng@tongji.edu.cn" target="_blank"><i class="fas fa-envelope" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fas fa-rss" aria-hidden="true"></i></a></li></ul><ul class="social-links"><li><a class="e-social-link" href="/" target="_blank"><i class="fas fa-graduation-cap" aria-hidden="true"></i><span>Google Scholar</span></a></li><li><a class="e-social-link" href="/" target="_blank"><i class="fab fa-orcid" aria-hidden="true"></i><span>ORCID</span></a></li></ul></div><a class="cv-links" href="/attaches/CV.pdf" target="_blank"><i class="fas fa-file-pdf" aria-hidden="true"><span>My Detail CV</span></i></a></div></div><div class="page" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="page-title">【LangGraph】从零构建我的专属科研 AI Agent</h2><article><blockquote>
<p><strong>写在前面</strong>：以前我使用 LLM（如 ChatGPT）时，主要是简单的“问答模式”。虽然方便，但它有两个致命弱点：<strong>没有记忆</strong>（关掉窗口就忘了上下文）与<strong>无法控制</strong>（无法按固定流程“先读文件→再搜索→最后写摘要”）。今天系统学习了 <strong>LangGraph</strong>：它更像一张“建筑图纸”，允许我用<strong>状态（State）</strong>、**循环（Loop）<strong>与</strong>条件分支（Conditional Edges）**搭出可控且可扩展的智能体工作流。Github链接：<a target="_blank" rel="noopener" href="https://github.com/SSSuperfriendly/LangGraph_Agent.git">https://github.com/SSSuperfriendly/LangGraph_Agent.git</a></p>
</blockquote>
<h2 id="0-前言：为什么要用-LangGraph？">0. 前言：为什么要用 LangGraph？</h2>
<p>以前我使用 LLM 时主要是“单轮/多轮问答”。它的体验很强，但当我把它真正当作“科研助手”去长期使用时，问题会很快暴露出来：</p>
<ol>
<li><strong>没有记忆</strong>：关掉窗口，它就忘了我是谁，也忘了我之前的研究背景。</li>
<li><strong>无法控制</strong>：我没法让它按死命令执行任务（比如“先读文件，再搜索，最后写摘要”）。</li>
</ol>
<p>LangGraph 的价值在于：我可以把 Agent 的行为写成一个<strong>有状态的图（Graph）</strong>。与“链式调用（chain）”相比，它天然支持：</p>
<ul>
<li><strong>循环与中断</strong>（更像在写程序，而不是写脚本）</li>
<li><strong>条件分支决策</strong>（让 Agent 自己选择是否调用工具）</li>
<li><strong>持久化记忆</strong>（让它不再“失忆”）</li>
</ul>
<hr>
<h2 id="1-核心概念：Agent-的“三驾马车”">1. 核心概念：Agent 的“三驾马车”</h2>
<p>在 LangGraph 中，构建一个可用的 Agent，最关键的是搞懂三个概念：</p>
<h3 id="1-1-状态-State-——-它的“大脑”">1.1 状态 (State) —— 它的“大脑”</h3>
<p>状态就是 Agent 的<strong>共享内存</strong>。所有关键数据（对话历史、当前轮次、文件内容、工具返回）都存在这里。</p>
<ul>
<li><strong>关键点</strong>：使用 <code>add_messages</code> 机制，让新的聊天记录自动追加到历史中，而不是覆盖。</li>
</ul>
<h3 id="1-2-节点-Nodes-——-它的“动作”">1.2 节点 (Nodes) —— 它的“动作”</h3>
<p>节点就是具体的 <strong>Python 函数</strong>（或封装后的可执行单元）。</p>
<ul>
<li>比如：一个节点负责“调用 DeepSeek 生成回复”，另一个节点负责“去 E 盘读取 PDF 文件”。</li>
<li>每个节点接收当前状态，执行动作，然后返回更新后的状态。</li>
</ul>
<h3 id="1-3-边-Edges-——-它的“决策”">1.3 边 (Edges) —— 它的“决策”</h3>
<p>边决定了下一步走哪儿。</p>
<ul>
<li><strong>条件边</strong>：Agent 可以自己决定是“继续对话”还是“去查资料”。</li>
<li><strong>循环</strong>：可以设置 <code>ITERATION_LIMIT</code>（或在业务逻辑中限制轮次），防止 Agent 陷入死循环。</li>
</ul>
<hr>
<h2 id="2-我的实战成果：DeepSeek-本地科研助手">2. 我的实战成果：DeepSeek 本地科研助手</h2>
<p>结合教程与自己的使用场景，我在 E 盘落地了一个<strong>不会失忆、能读论文、能联网</strong>的科研助手。</p>
<h3 id="2-1-环境配置（E-盘避坑指南）">2.1 环境配置（E 盘避坑指南）</h3>
<p>为了不塞满 C 盘，我采用了“全局+本地”的配置思路：</p>
<ul>
<li><strong>虚拟环境</strong>：<code>.venv</code> 建立在项目根目录。</li>
<li><strong>缓存重定向</strong>：<code>PIP_CACHE</code>、<code>HF_HOME</code> 等缓存目录指向 E 盘。</li>
<li><strong>模型调用</strong>：通过 OpenAI 兼容接口调用 <strong>DeepSeek-V3</strong>（性价比极高）。</li>
</ul>
<h3 id="2-2-核心功能进化史">2.2 核心功能进化史</h3>
<h4 id="v1-0：简单的聊天机器人">v1.0：简单的聊天机器人</h4>
<p>实现了基本的对话，但一关机就“失忆”。</p>
<ul>
<li><strong>痛点</strong>：每次都要重新介绍“我是陈鲲鹏，做图联邦学习的”。</li>
</ul>
<h4 id="v2-0：持久化记忆-The-Game-Changer">v2.0：持久化记忆 (The Game Changer)</h4>
<p>引入 <code>SqliteSaver</code>，把对话状态落盘。</p>
<ul>
<li><strong>原理</strong>：在 E 盘生成 <code>agent_memory.db</code> 数据库文件。</li>
<li><strong>效果</strong>：即使电脑重启，只要 <code>thread_id</code> 不变，它依然记得我的名字和研究方向。</li>
</ul>
<h4 id="v3-0：科研完全体-Tools-Integration">v3.0：科研完全体 (Tools Integration)</h4>
<p>给 Agent 装上了“手”和“眼”。</p>
<ul>
<li><strong>PyMuPDF</strong>：可以解析本地 PDF 论文（双栏排版也能读）。</li>
<li><strong>Arxiv API</strong>：联网搜索最新的 <code>Graph Federated Learning</code> 论文。</li>
<li><strong>本地文件读取</strong>：可以直接读取 <code>.py</code> 代码或 <code>.txt</code> 笔记。</li>
</ul>
<hr>
<h2 id="3-最终版代码模板（可直接改造成你的项目结构）">3. 最终版代码模板（可直接改造成你的项目结构）</h2>
<p>下面是我当前使用的 <code>ai_agent.py</code> 核心逻辑模板，展示了：工具集成、模型绑定工具、图结构与 SQLite 持久化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> fitz  <span class="comment"># PyMuPDF</span></span><br><span class="line"><span class="keyword">import</span> arxiv</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage, SystemMessage</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.sqlite <span class="keyword">import</span> SqliteSaver</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 1. 定义工具 (Tools) ---</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_pdf_paper</span>(<span class="params">file_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;读取本地 E 盘 PDF 论文&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ... (省略具体实现，使用 fitz 读取)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;PDF内容...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_arxiv</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;联网搜索 Arxiv&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ... (省略具体实现，使用 arxiv 库)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;论文列表...&quot;</span></span><br><span class="line"></span><br><span class="line">tools = [read_pdf_paper, search_arxiv]</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 2. 配置模型 (DeepSeek) ---</span></span><br><span class="line">load_dotenv()</span><br><span class="line">model = ChatOpenAI(</span><br><span class="line">    model=<span class="string">&#x27;deepseek-chat&#x27;</span>,</span><br><span class="line">    openai_api_key=os.getenv(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    openai_api_base=os.getenv(<span class="string">&quot;DEEPSEEK_BASE_URL&quot;</span>)</span><br><span class="line">).bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 3. 构建图 (Graph) ---</span></span><br><span class="line">builder = StateGraph(State)  <span class="comment"># State 定义略</span></span><br><span class="line">builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot_node)</span><br><span class="line">builder.add_node(<span class="string">&quot;tools&quot;</span>, ToolNode(tools))</span><br><span class="line"></span><br><span class="line">builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line"><span class="comment"># 核心：让模型自动判断是否调用工具</span></span><br><span class="line">builder.add_conditional_edges(<span class="string">&quot;chatbot&quot;</span>, tools_condition)</span><br><span class="line">builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 4. 持久化运行 ---</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    conn = sqlite3.connect(<span class="string">&quot;E:/LangGraph_Project/agent_memory.db&quot;</span>, check_same_thread=<span class="literal">False</span>)</span><br><span class="line">    memory = SqliteSaver(conn)</span><br><span class="line">    graph = builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 只要这个 ID 不变，记忆就在</span></span><br><span class="line">    config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;kunpeng_research_main&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ... (进入对话循环)</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="4-心得与展望">4. 心得与展望</h2>
<p><strong>LangGraph 的核心优势</strong>：相比于传统的链式调用，LangGraph 更像是在<strong>写程序</strong>而不是<strong>写脚本</strong>。由于支持循环、条件分支与状态持久化，它非常适合处理长周期任务（例如辅助完成一篇论文从调研到写作的全过程）。</p>
<p><strong>下一步计划</strong>：</p>
<ol>
<li><strong>人机协作</strong>：在 Agent 发出 Arxiv 搜索请求前增加“人工确认”（<code>interrupt</code> 机制），防止它搜错方向。</li>
<li><strong>多智能体</strong>：尝试搞一个“写手 Agent”和一个“审核 Agent”，左手写代码，右手改 Bug。</li>
</ol>
<hr>
<blockquote>
<p><em>本文基于云朵君《使用 LangGraph 构建 AI Agent》一文及个人实战总结。</em></p>
</blockquote>
</article><div class="share-section"><span class="share-label">分享本文</span><div class="share-buttons"><a class="share-btn share-twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fsssuperfriendly.github.io%2F2026%2F02%2F08%2F%25E3%2580%2590LangGraph%25E3%2580%2591%25E4%25BB%258E%25E9%259B%25B6%25E6%259E%2584%25E5%25BB%25BA%25E6%2588%2591%25E7%259A%2584%25E4%25B8%2593%25E5%25B1%259E%25E7%25A7%2591%25E7%25A0%2594%2520AI%2520Agent%2F&amp;text=%E3%80%90LangGraph%E3%80%91%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E6%88%91%E7%9A%84%E4%B8%93%E5%B1%9E%E7%A7%91%E7%A0%94%20AI%20Agent" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter"></i><span>Twitter / X</span></a><a class="share-btn share-linkedin" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fsssuperfriendly.github.io%2F2026%2F02%2F08%2F%25E3%2580%2590LangGraph%25E3%2580%2591%25E4%25BB%258E%25E9%259B%25B6%25E6%259E%2584%25E5%25BB%25BA%25E6%2588%2591%25E7%259A%2584%25E4%25B8%2593%25E5%25B1%259E%25E7%25A7%2591%25E7%25A0%2594%2520AI%2520Agent%2F" target="_blank" rel="noopener noreferrer"><i class="fab fa-linkedin"></i><span>LinkedIn</span></a><a class="share-btn share-copy" href="javascript:void(0)" onclick="copyShareLink('https://sssuperfriendly.github.io/2026/02/08/%E3%80%90LangGraph%E3%80%91%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E6%88%91%E7%9A%84%E4%B8%93%E5%B1%9E%E7%A7%91%E7%A0%94%20AI%20Agent/')"><i class="fas fa-link"></i><span>复制链接</span></a></div></div><script>function copyShareLink(url) {
    var btn = document.querySelector('.share-copy span');
    navigator.clipboard.writeText(url).then(function() {
        btn.textContent = '已复制！';
        setTimeout(function() { btn.textContent = '复制链接'; }, 2000);
    }).catch(function() {
        var ta = document.createElement('textarea');
        ta.value = url;
        ta.style.position = 'fixed';
        ta.style.opacity = '0';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        btn.textContent = '已复制！';
        setTimeout(function() { btn.textContent = '复制链接'; }, 2000);
    });
}</script></div></main><div class="nav-wrap"><div class="nav"><button class="site-nav"><div class="navicon"></div></button><ul class="nav_items"><li class="nav_item"><a class="nav-page" href="/"> About Me</a></li><li class="nav_item"><a class="nav-page" href="/news/"> News</a></li><li class="nav_item"><a class="nav-page" href="/#Publications"> Publications</a></li><li class="nav_item"><a class="nav-page" href="/categories/Blogs/"> Blogs</a></li></ul></div><div class="cd-top"><i class="fa fa-arrow-up" aria-hidden="true"></i></div></div><footer id="page_footer"><div class="footer_wrap"><div class="copyright">&copy;2025 - 2026 by Chen Kunpeng</div><div class="theme-info">Powered by <a target="_blank" href="https://hexo.io" rel="nofollow noopener">Hexo</a> & <a target="_blank" href="https://github.com/PhosphorW/hexo-theme-academia" rel="nofollow noopener">Academia Theme</a></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery-pjax@latest/jquery.pjax.min.js"></script><script src="/js/main.js"></script></body></html>